---
title: "Lecture_3"
output: html_document
---

Read in the baby data and create a variable for the mother's BMI category
```{r}
data<- read.csv("https://raw.githubusercontent.com/data-8/textbook/refs/heads/main/assets/data/baby.csv")
head(data)
```

# Investigating assumptions from plots: plot gestational days vs birth weight

For simple linear regression with only one independent variable (predictor) this should make serious violations apparent. 
```{r}
ggplot(data) + geom_point(aes(x = Gestational.Days, y = Birth.Weight))
```
#Example 1: Gestational days as a predictor of birth weight
 
$$Y_i = \beta_0 + \beta_1X_1 + \epsilon_i$$
Where $X_1$ is length of pregnancy, $Y_i$ is birthweight


```{r}
bw_model <- lm(Birth.Weight ~ Gestational.Days, data = data)
summary(bw_model)
```

Can reject null hypothesis that $\beta1 = 0$

```{r}
confint(bw_model)
```

# QQ plot: checking assumptions of normality
```{r}
plot(bw_model, which = 2)
```



# Example 2: Multivariable regression: gestational days and smoking status

```{r}
multi_model <- lm(Birth.Weight ~ Gestational.Days + factor(Maternal.Smoker), data = data)
summary(multi_model)
```
```{r}
ggplot(data) + geom_point(aes(x = Gestational.Days, y = Birth.Weight,
                              color = Maternal.Smoker))
```

# Residual plot
```{r}
plot(multi_model$fitted.values,  multi_model$residuals, main = "Residual plot", xlab="Fitted values", ylab="Residuals", pch=19)
abline(h=0)
```
OR
```{r}
plot(multi_model, which = 1)
```
# QQ plot

```{r}
plot(multi_model, which = 2)
```
 
#Cook's distance
```{r}
plot(multi_model, which=4)
```




# Example 3: Quadratic terms
```{r}
quad_model <- lm(Birth.Weight ~ Gestational.Days +  Gestational.Days^2, data = data)
summary(quad_model)
```

# Example 4: Interaction terms 
```{r}
int_model <- lm(Birth.Weight ~ Gestational.Days + factor(Maternal.Smoker) + Gestational.Days*factor(Maternal.Smoker), data = data)
summary(int_model)
```
Evidence that there is an interaction.

No interaction model:
```{r}
no_int_model <- lm(Birth.Weight ~ Gestational.Days + factor(Maternal.Smoker),
                   data = data)
summary(no_int_model)
```



#Appendix:  ANOVA and R-squared

$$SS_{tot} = SS_{reg} + SS_{res}$$
$$R^2 = \frac{SS_{reg}}{SS_{tot}}$$
```{r}
model_gd <- lm(Birth.Weight~Gestational.Days, data=data)
summary(model_gd)
```
R-squared shouldn't be used to compare models because it will never decrease when new covariates are added to the model, adjusted R-sqaured can help but better to compare models other ways

Nested models can be compared with Analysis of Variance (ANOVA)
- Sum of Squares: total variation partitioned into predictable (reg) and unpredictable components (res)
- degreees of freedom: each sum of squares as an associated degree of freedom -- the regression d.f. is the number of covariates in the regression model p , the total is n-p and the residual is n-p - regression. 
- mean squares: sum of squares/ degrees of freedom, residual mean-square = sigma^2

# Hypothesis testing with ANOVA
```{r}
anova(model_gd)
```

Here the pvalue for the F-test is identical to the p-value for the t-test.
F = 233.4 = 15.24^2 = t^2

F test useful for multiple covariantes 

Gestational days and height
```{r}
# ANOVA for Model 4 
data$Gestational.Days.Centered<-data$Gestational.Days-mean(data$Gestational.Days)
data$Maternal.Height.Centered<-data$Maternal.Height-mean(data$Maternal.Height)

model_gd_h<-lm(Birth.Weight~Gestational.Days.Centered+Maternal.Height.Centered, data=data)
summary(model_gd_h)
```

Partial F-test: compare model with only gestational days to gestational days and height
```{r}
anova(model_gd, model_gd_h)
```


# Residual plot
```{r}
plot(bw_model, which = 1)
```

Unequal distribution of residuals around zero indicates non-linearity. 


Q-Q- plot = observed values against standard normal distribution (if perfect Y = X)

Cook's distance: measure of the influence of an observation (has a lareg impact on the parameter estimate)
Worth checking to identify outliers. 

Obtained from removing the ith observation and refitting the model and comparing the new fitted values vs the ones with the complete data. Therefore the higher the D the more influential the observation 
```{r}
plot(bw_model, which = 4)
```



